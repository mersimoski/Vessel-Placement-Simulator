@using BlazorApp.Models

<div class="anchorage-container">
    <div class="anchorage-grid" 
         @ref="gridElement"
         style="grid-template-columns: repeat(@AnchorageWidth, 1fr); grid-template-rows: repeat(@AnchorageHeight, 1fr);"
         id="anchorage-grid-@(GetHashCode())">
        @for (int y = 0; y < AnchorageHeight; y++)
        {
            @for (int x = 0; x < AnchorageWidth; x++)
            {
                var cellX = x;
                var cellY = y;
                <div class="grid-cell drop-zone" 
                     data-x="@cellX" 
                     data-y="@cellY"
                     data-grid-x="@cellX"
                     data-grid-y="@cellY">
                </div>
            }
        }

        @foreach (var vessel in PlacedVessels)
        {
            var colStart = vessel.X + 1;
            var colEnd = vessel.X + vessel.EffectiveWidth + 1;
            var rowStart = vessel.Y + 1;
            var rowEnd = vessel.Y + vessel.EffectiveHeight + 1;
            
            <div class="placed-vessel"
                 style="grid-column-start: @colStart; grid-column-end: @colEnd; grid-row-start: @rowStart; grid-row-end: @rowEnd;"
                 @onclick="@(() => HandleVesselClick(vessel.Id))">
                @{
                    // Calculate viewBox to exactly match vessel proportions
                    // Use a scale factor to make numbers reasonable (multiply dimensions by 10)
                    var width = vessel.EffectiveWidth;
                    var height = vessel.EffectiveHeight;
                    var scale = 10.0;
                    var viewBoxWidth = width * scale;
                    var viewBoxHeight = height * scale;
                }
                <div class="vessel-content">
                    @if (width >= height)
                    {
                        <!-- Horizontal vessel (wider than tall) -->
                        <svg viewBox="0 0 @(viewBoxWidth) @(viewBoxHeight)" class="vessel-icon" preserveAspectRatio="xMidYMid meet">
                            <!-- Hull -->
                            <rect x="@(viewBoxWidth * 0.05)" y="@(viewBoxHeight * 0.33)" width="@(viewBoxWidth * 0.9)" height="@(viewBoxHeight * 0.42)" fill="#dc3545" rx="@(viewBoxWidth * 0.04)"/>
                            <!-- Superstructure -->
                            <rect x="@(viewBoxWidth * 0.1)" y="@(viewBoxHeight * 0.08)" width="@(viewBoxWidth * 0.8)" height="@(viewBoxHeight * 0.33)" fill="#ffffff" rx="@(viewBoxWidth * 0.02)"/>
                            <!-- Windows -->
                            @for (int i = 0; i < Math.Min(5, width); i++)
                            {
                                var windowX = viewBoxWidth * (0.2 + (i * 0.15));
                                <circle cx="@windowX" cy="@(viewBoxHeight * 0.25)" r="@(viewBoxWidth * 0.025)" fill="#6c757d"/>
                            }
                            <!-- Mast -->
                            <line x1="@(viewBoxWidth * 0.5)" y1="0" x2="@(viewBoxWidth * 0.5)" y2="@(viewBoxHeight * 0.08)" stroke="#6c757d" stroke-width="@(viewBoxWidth * 0.015)"/>
                            <!-- Water -->
                            <ellipse cx="@(viewBoxWidth * 0.5)" cy="@(viewBoxHeight * 0.92)" rx="@(viewBoxWidth * 0.5)" ry="@(viewBoxHeight * 0.08)" fill="#0dcaf0" opacity="0.5"/>
                        </svg>
                    }
                    else
                    {
                        <!-- Vertical vessel (taller than wide) -->
                        <svg viewBox="0 0 @(viewBoxWidth) @(viewBoxHeight)" class="vessel-icon" preserveAspectRatio="xMidYMid meet">
                            <!-- Hull -->
                            <rect x="@(viewBoxWidth * 0.33)" y="@(viewBoxHeight * 0.05)" width="@(viewBoxWidth * 0.42)" height="@(viewBoxHeight * 0.9)" fill="#dc3545" rx="@(viewBoxHeight * 0.04)"/>
                            <!-- Superstructure -->
                            <rect x="@(viewBoxWidth * 0.08)" y="@(viewBoxHeight * 0.1)" width="@(viewBoxWidth * 0.33)" height="@(viewBoxHeight * 0.8)" fill="#ffffff" rx="@(viewBoxHeight * 0.02)"/>
                            <!-- Windows -->
                            @for (int i = 0; i < Math.Min(4, height); i++)
                            {
                                var windowY = viewBoxHeight * (0.25 + (i * 0.15));
                                <circle cx="@(viewBoxWidth * 0.25)" cy="@windowY" r="@(viewBoxHeight * 0.025)" fill="#6c757d"/>
                            }
                            <!-- Mast -->
                            <line x1="0" y1="@(viewBoxHeight * 0.5)" x2="@(viewBoxWidth * 0.08)" y2="@(viewBoxHeight * 0.5)" stroke="#6c757d" stroke-width="@(viewBoxHeight * 0.015)"/>
                            <!-- Water -->
                            <ellipse cx="@(viewBoxWidth * 0.83)" cy="@(viewBoxHeight * 0.5)" rx="@(viewBoxWidth * 0.08)" ry="@(viewBoxHeight * 0.5)" fill="#0dcaf0" opacity="0.5"/>
                        </svg>
                    }
                </div>
            </div>
        }
    </div>
</div>

<div class="mt-2">
    <small class="text-muted">Click on a placed vessel to remove it</small>
</div>

